<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Low Bandwidth Player</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.5/shaka-player.compiled.js"></script>
<style>
  body{background:#000;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:0;}
  video{width:90%;max-width:960px;height:auto;margin-top:20px;border-radius:8px;background:#000;}
  .server-btn{background:#FF3B3B;color:#fff;border:none;padding:10px 16px;font-size:16px;border-radius:6px;cursor:pointer;margin:10px 5px;}
  .server-btn.active{background:#00FFAA;color:#000;}
  #resolution{margin-top:10px;color:#ccc;font-size:14px;}
</style>
</head>
<body>
<h2>Low Bandwidth Sports Player</h2>

<video id="videoPlayer" controls autoplay></video>
<div>
  <button class="server-btn active" 
    data-url="https://a168aivottlinear-a.akamaihd.net/IAD/lhr-nitro/clients/dash/enc/llriqg36oy/out/v1/d5d0b76a4cab4567888ffea90cc42a2c/cenc.mpd"
    data-clearkey='{"31f91da574d667855834640e323f647d":"044dbc740ad84f6069277a6cabd76adf"}'>Willow AQ</button>

  <button class="server-btn" 
    data-url="https://a166aivottlinear-a.akamaihd.net/OTTB/sin-nitro/live/dash/enc/f0qvkrra8j/out/v1/f8fa17f087564f51aa4d5c700be43ec4/cenc.mpd"
    data-clearkey='{"0d9efa8287a52a2497a281f7a9012211":"e4f832d372943014fe5c30928a90e547"}'>TNT SPORTS AQ</button>
</div>

<div id="resolution">Current Resolution: --</div>

<script>
shaka.polyfill.installAll();

if (shaka.Player.isBrowserSupported()) {
  const video = document.getElementById('videoPlayer');
  const player = new shaka.Player(video);

  player.addEventListener('error', (e) => console.error('Error', e.detail));

  // Restrict min bitrate to 500kbps (~0.5 Mbps) so slow networks play
  player.configure({
    abr: {
      restrictions: {
        minBandwidth: 500 * 1000,   // 0.5 Mbps
        maxBandwidth: 1500 * 1000   // 1.5 Mbps max for low bandwidth
      },
      enabled: true
    },
    streaming: {
      rebufferingGoal: 10, // buffer 10 seconds
      bufferingGoal: 15    // maintain 15 seconds buffer
    }
  });

  const buttons = document.querySelectorAll('.server-btn');

  function loadStream(url, clearkey){
    player.configure({
      drm: { clearKeys: clearkey }
    });
    player.load(url).then(()=>{
      console.log('Stream loaded:', url);
    }).catch(e=>console.error('Load failed', e));
  }

  // Resolution display
  setInterval(() => {
    const tracks = player.getVariantTracks();
    const active = tracks.find(t => t.active);
    if(active){
      document.getElementById('resolution').innerText = 'Current Resolution: ' + active.height + 'p / ' + Math.round(active.bandwidth/1000) + ' kbps';
    }
  }, 1000);

  // Button click
  buttons.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      buttons.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');

      const url = btn.dataset.url;
      const clearkey = JSON.parse(btn.dataset.clearkey);
      loadStream(url, clearkey);
    });
  });

  // Load first stream by default
  const firstBtn = document.querySelector('.server-btn.active');
  loadStream(firstBtn.dataset.url, JSON.parse(firstBtn.dataset.clearkey));

} else {
  alert('Browser not supported!');
}
</script>

</body>
</html>
